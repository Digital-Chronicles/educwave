{% extends "base.html" %}
{% load static %}

{% block content %}
<div class="bg-white shadow rounded-lg p-6 max-w-3xl mx-auto">
  <h2 class="text-2xl font-bold text-gray-800 mb-6">
    {% if object %}Edit{% else %}Create{% endif %} Fee Transaction
  </h2>
  
  <form method="post" class="space-y-6">
    {% csrf_token %}
    
    {% if form.non_field_errors %}
      <div class="bg-red-50 border-l-4 border-red-500 p-4 mb-6">
        {% for error in form.non_field_errors %}
          <p class="text-red-700">{{ error }}</p>
        {% endfor %}
      </div>
    {% endif %}

    <!-- Student Selection -->
    <div>
      <label for="{{ form.student.id_for_label }}" class="block text-sm font-medium text-gray-700 mb-1">
        {{ form.student.label }}
      </label>
      {{ form.student }}
      {% if form.student.errors %}
        <p class="mt-1 text-sm text-red-600">{{ form.student.errors.as_text }}</p>
      {% endif %}
      <p class="mt-1 text-sm text-gray-500">Search by student name</p>
    </div>

    <!-- Amount Fields -->
    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
      <div>
        <label for="{{ form.amount_paid.id_for_label }}" class="block text-sm font-medium text-gray-700 mb-1">
          Amount Paid (₦)
        </label>
        {{ form.amount_paid }}
        {% if form.amount_paid.errors %}
          <p class="mt-1 text-sm text-red-600">{{ form.amount_paid.errors.as_text }}</p>
        {% endif %}
      </div>

      {% if form.amount_due %}
      <div>
        <label for="{{ form.amount_due.id_for_label }}" class="block text-sm font-medium text-gray-700 mb-1">
          Total Fee Due (₦)
        </label>
        {{ form.amount_due }}
      </div>
      {% endif %}
    </div>

    <!-- Payment Details -->
    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
      <div>
        <label for="{{ form.payment_method.id_for_label }}" class="block text-sm font-medium text-gray-700 mb-1">
          Payment Method
        </label>
        {{ form.payment_method }}
        {% if form.payment_method.errors %}
          <p class="mt-1 text-sm text-red-600">{{ form.payment_method.errors.as_text }}</p>
        {% endif %}
      </div>

      <div>
        <label for="{{ form.status.id_for_label }}" class="block text-sm font-medium text-gray-700 mb-1">
          Payment Status
        </label>
        {{ form.status }}
        {% if form.status.errors %}
          <p class="mt-1 text-sm text-red-600">{{ form.status.errors.as_text }}</p>
        {% endif %}
      </div>
    </div>

    <!-- Date Fields -->
    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
      <div>
        <label for="{{ form.due_date.id_for_label }}" class="block text-sm font-medium text-gray-700 mb-1">
          Due Date
        </label>
        {{ form.due_date }}
        {% if form.due_date.errors %}
          <p class="mt-1 text-sm text-red-600">{{ form.due_date.errors.as_text }}</p>
        {% endif %}
      </div>
    </div>

    <!-- Reference and Remarks -->
    <div>
      <label for="{{ form.payment_reference.id_for_label }}" class="block text-sm font-medium text-gray-700 mb-1">
        Payment Reference
      </label>
      {{ form.payment_reference }}
      {% if form.payment_reference.errors %}
        <p class="mt-1 text-sm text-red-600">{{ form.payment_reference.errors.as_text }}</p>
      {% endif %}
    </div>

    <div>
      <label for="{{ form.remarks.id_for_label }}" class="block text-sm font-medium text-gray-700 mb-1">
        Remarks
      </label>
      {{ form.remarks }}
      {% if form.remarks.errors %}
        <p class="mt-1 text-sm text-red-600">{{ form.remarks.errors.as_text }}</p>
      {% endif %}
    </div>

    <!-- Form Actions -->
    <div class="mt-8 flex justify-end space-x-3">
      <a href="{% url 'transaction_list' %}" class="inline-flex items-center px-4 py-2 border border-gray-300 shadow-sm text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500">
        Cancel
      </a>
      <button type="submit" class="inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md shadow-sm text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500">
        {% if object %}Update{% else %}Create{% endif %} Transaction
      </button>
    </div>
  </form>
</div>

<!-- Initialize Select2 and date picker -->
<script>
document.addEventListener('DOMContentLoaded', function() {
    // Initialize Select2
    $('select').select2({
        width: '100%',
        theme: 'bootstrap',
        minimumResultsForSearch: 1
    });
    
    // Set today's date as default if empty
    const today = new Date().toISOString().split('T')[0];
    $('input[type="date"]').each(function() {
        if (!this.value) this.value = today;
    });
});
</script>
{% endblock %}